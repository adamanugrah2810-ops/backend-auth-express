<!doctype html>
<html>
  <head>
    <title>Users</title>
  </head>
  <body>
    <h2>Daftar User</h2>
    <button onclick="logout()">Logout</button>
    <table border="1" cellpadding="5">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nama</th>
          <th>Email</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody id="userTable"></tbody>
    </table>

    <script>
      const token = localStorage.getItem("token");

      fetch("http://localhost:3000/api/auth/users", {
        headers: {
          Authorization: token,
        },
      })
        .then((res) => res.json())
        .then((users) => {
          let rows = "";
          users.forEach((u) => {
            rows += `
          <tr>
            <td>${u.id}</td>
            <td>${u.name}</td>
            <td>${u.email}</td>
            <td>
              <button onclick="hapus(${u.id})">Hapus</button>
            </td>
          </tr>
        `;
          });
          document.getElementById("userTable").innerHTML = rows;
        });

      function hapus(id) {
        fetch("http://localhost:3000/api/auth/users/" + id, {
          method: "DELETE",
          headers: {
            Authorization: token,
          },
        })
          .then((res) => res.json())
          .then((data) => {
            alert(data.message);
            location.reload();
          });
      }

      function logout() {
        localStorage.removeItem("token");
        window.location.href = "login.html";
      }
    </script>
  </body>
</html>
