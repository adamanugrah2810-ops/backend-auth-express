<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Management Produk | Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
      }
    </style>
  </head>
  <body class="bg-slate-50 min-h-screen flex">
    <aside
      class="w-64 bg-slate-900 text-white flex flex-col fixed h-full z-10 transition-all"
    >
      <div class="p-8">
        <div class="flex items-center gap-3 mb-10">
          <div
            class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center shadow-lg shadow-blue-500/40"
          >
            <span class="text-xl font-bold">A</span>
          </div>
          <h3 class="text-xl font-bold tracking-tight">
            Admin<span class="text-blue-500">Panel</span>
          </h3>
        </div>
        <nav class="space-y-2">
          <a
            href="dashboard.html"
            class="flex items-center gap-3 p-3 text-slate-400 hover:text-white hover:bg-slate-800 rounded-xl transition-all"
          >
            Dashboard
          </a>
          <a
            href="products.html"
            class="flex items-center gap-3 p-3 bg-blue-600 text-white rounded-xl shadow-lg shadow-blue-600/20 transition-all"
          >
            Products
          </a>
          <a
            href="users.html"
            class="flex items-center gap-3 p-3 text-slate-400 hover:text-white hover:bg-slate-800 rounded-xl transition-all"
          >
            Users
          </a>
        </nav>
      </div>
    </aside>

    <main class="ml-64 flex-1 p-10">
      <div class="flex justify-between items-end mb-10">
        <div>
          <nav class="text-sm text-slate-400 mb-2 font-medium">
            Inventory &bull; Management
          </nav>
          <h1 class="text-4xl font-extrabold text-slate-900 tracking-tight">
            Daftar Produk
          </h1>
        </div>

        <a
          href="add-product.html"
          onclick="localStorage.removeItem('editProduct')"
        >
          <button
            class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-2xl font-bold shadow-xl shadow-blue-600/20 transition-all hover:-translate-y-1 active:scale-95 flex items-center gap-2"
          >
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="3"
                d="M12 4v16m8-8H4"
              ></path>
            </svg>
            Tambah Produk Baru
          </button>
        </a>
      </div>

      <div
        class="bg-white rounded-[2rem] shadow-sm border border-slate-100 overflow-hidden"
      >
        <table class="w-full text-left border-collapse">
          <thead>
            <tr class="bg-slate-50/50 border-b border-slate-100">
              <th
                class="py-5 px-8 text-[11px] font-bold text-slate-400 uppercase tracking-widest"
              >
                ID
              </th>
              <th
                class="py-5 px-8 text-[11px] font-bold text-slate-400 uppercase tracking-widest"
              >
                Informasi Produk
              </th>
              <th
                class="py-5 px-8 text-[11px] font-bold text-slate-400 uppercase tracking-widest"
              >
                Harga Unit
              </th>
              <th
                class="py-5 px-8 text-[11px] font-bold text-slate-400 uppercase tracking-widest"
              >
                Status Stok
              </th>
              <th
                class="py-5 px-8 text-[11px] font-bold text-slate-400 uppercase tracking-widest text-center"
              >
                Aksi
              </th>
            </tr>
          </thead>
          <tbody id="productTable" class="divide-y divide-slate-50">
            <tr>
              <td
                colspan="5"
                class="p-10 text-center text-slate-400 animate-pulse"
              >
                Memuat data produk...
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </main>

    <script>
      const API = "http://localhost:3000/api/products";
      const tokenHeader = "Bearer " + localStorage.getItem("token");

      // Format mata uang Rupiah
      const formatRupiah = (n) =>
        new Intl.NumberFormat("id-ID", {
          style: "currency",
          currency: "IDR",
          minimumFractionDigits: 0,
        }).format(n);

      // Mengambil data dari database
      function loadProducts() {
        fetch(API, { headers: { Authorization: tokenHeader } })
          .then((r) => {
            if (!r.ok) throw new Error("Gagal akses API");
            return r.json();
          })
          .then((data) => {
            let products = data.products || data;
            let html = "";

            if (products.length === 0) {
              html = `<tr><td colspan="5" class="p-10 text-center text-slate-400 italic">Belum ada produk.</td></tr>`;
            } else {
              products.forEach((p) => {
                const stockColor =
                  p.stock < 10
                    ? "bg-red-50 text-red-600 border-red-100"
                    : "bg-emerald-50 text-emerald-600 border-emerald-100";

                html += `
                                <tr class="group hover:bg-slate-50 transition-all duration-200">
                                    <td class="py-6 px-8 text-sm font-mono text-slate-400">#${p.id}</td>
                                    <td class="py-6 px-8">
                                        <div class="font-bold text-slate-800 text-lg group-hover:text-blue-600 transition-colors">${p.name}</div>
                                    </td>
                                    <td class="py-6 px-8 font-semibold text-slate-700">${formatRupiah(p.price)}</td>
                                    <td class="py-6 px-8">
                                        <span class="px-3 py-1.5 rounded-full text-xs font-bold border ${stockColor}">${p.stock} Available</span>
                                    </td>
                                    <td class="py-6 px-8">
                                        <div class="flex justify-center gap-2">
                                            <button onclick="edit(${p.id},'${p.name}',${p.price},${p.stock})" 
                                                class="bg-white border border-slate-200 hover:border-blue-500 hover:text-blue-600 px-4 py-2 rounded-xl text-sm font-bold transition-all active:scale-95 shadow-sm">
                                                Edit
                                            </button>
                                            <button onclick="hapus(${p.id})" 
                                                class="bg-white border border-slate-200 hover:border-red-500 hover:text-red-600 px-4 py-2 rounded-xl text-sm font-bold transition-all active:scale-95 shadow-sm">
                                                Hapus
                                            </button>
                                        </div>
                                    </td>
                                </tr>`;
              });
            }
            document.getElementById("productTable").innerHTML = html;
          })
          .catch((err) => {
            console.error(err);
            document.getElementById("productTable").innerHTML =
              `<tr><td colspan="5" class="p-10 text-center text-red-500">Error: Gagal memuat data dari server.</td></tr>`;
          });
      }

      // Fungsi Arahkan ke halaman edit
      function edit(id, n, p, s) {
        localStorage.setItem("editProduct", JSON.stringify({ id, n, p, s }));
        // Pastikan Anda sudah membuat file edit-product.html
        window.location = "edit-product.html";
      }

      // Fungsi Hapus Produk
      function hapus(id) {
        if (confirm("Apakah Anda yakin ingin menghapus produk ini?")) {
          fetch(API + "/" + id, {
            method: "DELETE",
            headers: { Authorization: tokenHeader },
          })
            .then((r) => r.json())
            .then(() => {
              loadProducts(); // Refresh tabel setelah hapus
            })
            .catch((err) => alert("Gagal menghapus produk"));
        }
      }

      // Jalankan saat halaman dibuka
      loadProducts();
    </script>
  </body>
</html>
