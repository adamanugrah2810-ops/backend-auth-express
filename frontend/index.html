<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Auth App</title>
    <style>
      body {
        margin: 0;
        font-family: Arial;
        background: #f2f2f2;
      }

      .container {
        width: 400px;
        margin: 80px auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
      }

      input,
      button {
        width: 100%;
        padding: 10px;
        margin: 5px 0;
      }

      button {
        background: #4caf50;
        color: white;
        border: none;
        cursor: pointer;
      }

      .hidden {
        display: none;
      }

      /* DASHBOARD LAYOUT */
      .app {
        display: flex;
        height: 100vh;
      }

      .sidebar {
        width: 200px;
        background: #2c3e50;
        color: white;
        padding: 20px;
      }

      .sidebar h3 {
        text-align: center;
      }

      .sidebar a {
        display: block;
        color: white;
        text-decoration: none;
        padding: 10px;
        margin-top: 5px;
        background: #34495e;
        border-radius: 5px;
      }

      .sidebar a:hover {
        background: #1abc9c;
      }

      .content {
        flex: 1;
        padding: 20px;
        background: #ecf0f1;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        background: white;
      }

      th,
      td {
        border: 1px solid #ccc;
        padding: 8px;
      }
    </style>
  </head>

  <body>
    <!-- REGISTER -->
    <div class="container" id="registerBox">
      <h2>Register</h2>
      <input type="text" id="regName" placeholder="Nama" />
      <input type="email" id="regEmail" placeholder="Email" />
      <input type="password" id="regPassword" placeholder="Password" />
      <button onclick="register()">Register</button>
      <p>Sudah punya akun? <a href="#" onclick="showLogin()">Login</a></p>
    </div>

    <!-- LOGIN -->
    <div class="container hidden" id="loginBox">
      <h2>Login</h2>
      <input type="email" id="loginEmail" placeholder="Email" />
      <input type="password" id="loginPassword" placeholder="Password" />
      <button onclick="login()">Login</button>
      <p>Belum punya akun? <a href="#" onclick="showRegister()">Register</a></p>
    </div>

    <!-- DASHBOARD -->
    <div class="app hidden" id="dashboardBox">
      <div class="sidebar">
        <h3>My App</h3>
        <a href="#" onclick="showDashboard()">Dashboard</a>
        <a href="#" onclick="showUsers()">User</a>
        <a href="#" onclick="logout()">Logout</a>
      </div>

      <div class="content" id="mainContent">
        <h2>Selamat Datang ðŸŽ‰</h2>
        <p>Ini adalah dashboard aplikasi kamu.</p>
      </div>
    </div>

    <script>
      const API = "http://localhost:3000/api/auth";

      function showLogin() {
        registerBox.classList.add("hidden");
        loginBox.classList.remove("hidden");
      }

      function showRegister() {
        loginBox.classList.add("hidden");
        registerBox.classList.remove("hidden");
      }

      function showDashboard() {
        loginBox.classList.add("hidden");
        registerBox.classList.add("hidden");
        dashboardBox.classList.remove("hidden");

        mainContent.innerHTML = `
    <h2>Dashboard</h2>
    <p>Selamat datang di aplikasi Auth App.</p>
  `;
      }

      function showUsers() {
        mainContent.innerHTML = `
    <h2>Data User</h2>
    <table>
      <thead>
        <tr>
          <th>ID</th><th>Nama</th><th>Email</th><th>Aksi</th>
        </tr>
      </thead>
      <tbody id="userTable"></tbody>
    </table>
  `;
        loadUsers();
      }

      // REGISTER
      function register() {
        fetch(API + "/register", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            name: regName.value,
            email: regEmail.value,
            password: regPassword.value,
          }),
        })
          .then((r) => r.json())
          .then((d) => {
            alert(d.message);
            showLogin();
          });
      }

      // LOGIN
      function login() {
        fetch(API + "/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            email: loginEmail.value,
            password: loginPassword.value,
          }),
        })
          .then((r) => r.json())
          .then((d) => {
            if (d.token) {
              localStorage.setItem("token", d.token);
              showDashboard();
            } else {
              alert("Login gagal");
            }
          });
      }

      // LOAD USERS
      function loadUsers() {
        fetch(API + "/users", {
          headers: { Authorization: localStorage.getItem("token") },
        })
          .then((r) => r.json())
          .then((users) => {
            let html = "";
            users.forEach((u) => {
              html += `
      <tr>
        <td>${u.id}</td>
        <td>${u.name}</td>
        <td>${u.email}</td>
        <td><button onclick="hapus(${u.id})">Hapus</button></td>
      </tr>
      `;
            });
            userTable.innerHTML = html;
          });
      }

      // DELETE
      function hapus(id) {
        fetch(API + "/users/" + id, {
          method: "DELETE",
          headers: { Authorization: localStorage.getItem("token") },
        })
          .then((r) => r.json())
          .then((d) => {
            alert(d.message);
            loadUsers();
          });
      }

      // LOGOUT
      function logout() {
        localStorage.removeItem("token");
        showLogin();
      }

      // AUTO LOGIN
      if (localStorage.getItem("token")) {
        showDashboard();
      }
    </script>
  </body>
</html>
