<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Edit Produk | Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
      }
      .input-focus:focus {
        border-color: #2563eb;
        box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1);
        outline: none;
      }
    </style>
  </head>
  <body class="bg-slate-50 min-h-screen flex">
    <aside
      class="w-64 bg-slate-900 text-white flex flex-col fixed h-full z-10 transition-all"
    >
      <div class="p-8">
        <div class="flex items-center gap-3 mb-10">
          <div
            class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center shadow-lg shadow-blue-500/40"
          >
            <span class="text-xl font-bold">A</span>
          </div>
          <h3 class="text-xl font-bold tracking-tight">
            Admin<span class="text-blue-500">Panel</span>
          </h3>
        </div>
        <nav class="space-y-2">
          <a
            href="dashboard.html"
            class="flex items-center gap-3 p-3 text-slate-400 hover:text-white hover:bg-slate-800 rounded-xl transition-all"
          >
            Dashboard
          </a>
          <a
            href="products.html"
            class="flex items-center gap-3 p-3 bg-blue-600 text-white rounded-xl shadow-lg shadow-blue-600/20 transition-all"
          >
            Products
          </a>
          <a
            href="users.html"
            class="flex items-center gap-3 p-3 text-slate-400 hover:text-white hover:bg-slate-800 rounded-xl transition-all"
          >
            Users
          </a>
        </nav>
      </div>
    </aside>

    <main class="ml-64 flex-1 p-10 flex flex-col items-center">
      <div class="w-full max-w-2xl mb-8">
        <nav class="text-sm text-slate-400 mb-2 font-medium">
          Inventory &bull; Edit Mode
        </nav>
        <h1 class="text-4xl font-extrabold text-slate-900 tracking-tight">
          Update Detail Produk
        </h1>
      </div>

      <div
        class="w-full max-w-2xl bg-white rounded-[2.5rem] shadow-sm border border-slate-100 p-12"
      >
        <div class="mb-8 flex items-center justify-between">
          <div>
            <h2 class="text-xl font-bold text-slate-800">Formulir Perubahan</h2>
            <p
              class="text-slate-400 text-sm font-medium italic"
              id="productIDDisplay"
            >
              Memuat ID...
            </p>
          </div>
          <div
            class="w-12 h-12 bg-amber-50 text-amber-500 rounded-2xl flex items-center justify-center"
          >
            <svg
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
              ></path>
            </svg>
          </div>
        </div>

        <div class="space-y-6">
          <div>
            <label
              class="block text-[11px] font-bold text-slate-400 uppercase tracking-widest mb-2 ml-1"
              >Nama Produk</label
            >
            <input
              id="name"
              type="text"
              placeholder="Masukkan nama baru..."
              class="w-full px-6 py-4 bg-slate-50 border border-slate-100 rounded-2xl font-semibold text-slate-700 input-focus transition-all"
            />
          </div>

          <div class="grid grid-cols-2 gap-6">
            <div>
              <label
                class="block text-[11px] font-bold text-slate-400 uppercase tracking-widest mb-2 ml-1"
                >Harga (IDR)</label
              >
              <input
                id="price"
                type="number"
                class="w-full px-6 py-4 bg-slate-50 border border-slate-100 rounded-2xl font-semibold text-slate-700 input-focus transition-all"
              />
            </div>
            <div>
              <label
                class="block text-[11px] font-bold text-slate-400 uppercase tracking-widest mb-2 ml-1"
                >Stok Gudang</label
              >
              <input
                id="stock"
                type="number"
                class="w-full px-6 py-4 bg-slate-50 border border-slate-100 rounded-2xl font-semibold text-slate-700 input-focus transition-all"
              />
            </div>
          </div>

          <div class="pt-6 flex gap-4">
            <button
              onclick="updateProduct()"
              class="flex-[2] bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-2xl shadow-lg shadow-blue-200 transition-all active:scale-95 flex items-center justify-center gap-2"
            >
              <svg
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M5 13l4 4L19 7"
                ></path>
              </svg>
              Simpan Perubahan
            </button>
            <button
              onclick="cancel()"
              class="flex-1 bg-slate-100 hover:bg-slate-200 text-slate-500 font-bold py-4 rounded-2xl transition-all"
            >
              Batal
            </button>
          </div>
        </div>
      </div>

      <p class="mt-8 text-slate-400 text-xs">
        Perubahan akan langsung diterapkan pada database pusat setelah Anda
        menekan tombol simpan.
      </p>
    </main>

    <script>
      const API = "http://localhost:3000/api/products";
      const token = localStorage.getItem("token");

      let editData = JSON.parse(localStorage.getItem("editProduct"));

      if (!editData) {
        alert("Sesi edit berakhir. Silakan pilih produk kembali.");
        window.location = "products.html";
      } else {
        document.getElementById("productIDDisplay").innerText =
          "Product Reference: #" + editData.id;
        document.getElementById("name").value = editData.n;
        document.getElementById("price").value = editData.p;
        document.getElementById("stock").value = editData.s;
      }

      function updateProduct() {
        const data = {
          name: document.getElementById("name").value,
          price: Number(document.getElementById("price").value),
          stock: Number(document.getElementById("stock").value),
        };

        if (!data.name || !data.price) {
          return alert("Mohon lengkapi Nama dan Harga produk!");
        }

        fetch(`${API}/${editData.id}`, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
            Authorization: "Bearer " + token,
          },
          body: JSON.stringify(data),
        })
          .then((res) => {
            if (!res.ok) throw new Error("Gagal update data");
            return res.json();
          })
          .then(() => {
            alert("Data produk berhasil diperbarui!");
            localStorage.removeItem("editProduct");
            window.location = "products.html";
          })
          .catch((err) => {
            console.error(err);
            alert("Terjadi kesalahan sistem.");
          });
      }

      function cancel() {
        localStorage.removeItem("editProduct");
        window.location = "products.html";
      }
    </script>
  </body>
</html>
